FROM ubuntu:20.04

ARG PREDECOS_AUTH_AUDIENCE
ARG PREDECOS_AUTH_JWKS_URI
ARG PREDECOS_AUTH_ISSUER
ARG PREDECOS_KAFKA_HOST
ARG PREDECOS_KAFKA_PORT
ARG PREDECOS_MICROSERVICE_ANALYSIS_URL
ARG PREDECOS_MICROSERVICE_COLLECTION_URL
ARG PREDECOS_MICROSERVICE_CONFIGURATION_URL
ARG NODE_ENV

ENV PREDECOS_AUTH_AUDIENCE=$PREDECOS_AUTH_AUDIENCE
ENV PREDECOS_AUTH_JWKS_URI=$PREDECOS_AUTH_JWKS_URI
ENV PREDECOS_AUTH_ISSUER=$PREDECOS_AUTH_ISSUER
ENV PREDECOS_KAFKA_HOST=$PREDECOS_KAFKA_HOST
ENV PREDECOS_KAFKA_PORT=$PREDECOS_KAFKA_PORT
ENV PREDECOS_MICROSERVICE_ANALYSIS_URL=$PREDECOS_MICROSERVICE_ANALYSIS_URL
ENV PREDECOS_MICROSERVICE_COLLECTION_URL=$PREDECOS_MICROSERVICE_COLLECTION_URL
ENV PREDECOS_MICROSERVICE_CONFIGURATION_URL=$PREDECOS_MICROSERVICE_CONFIGURATION_URL
ENV NODE_ENV=$NODE_ENV

WORKDIR /usr/src/app

RUN apt-get update

RUN apt-get install -y vim

RUN apt-get install -y curl

# Add nodejs 16.x
RUN /bin/bash -c "curl -sL https://deb.nodesource.com/setup_16.x | bash -"

RUN apt-get update

RUN apt-get install -y build-essential

RUN apt-get install -y nodejs

RUN npm i --global yarn

RUN yarn --version

COPY src/ ./src

COPY package.json ./

RUN yarn install

EXPOSE 4004

CMD ["yarn", "run", "start"]